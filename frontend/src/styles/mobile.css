/* 移动端专用样式 */

/* 重置移动端默认样式 */
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

/* 允许输入框选择文本 */
input, textarea {
  -webkit-user-select: text;
  user-select: text;
}

/* 移动端根元素 */
html {
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* 全局 reset，视口占满，交给 body 滚动 */
html, body {
  height: 100%;
  margin: 0;
}

/* 把 body 变成 Flex 容器，纵向排列 */
body {
  /* 允许正常滚动 */
  overflow-x: hidden;
  overflow-y: auto;
  
  display: flex;
  flex-direction: column;
  
  /* 移动端字体优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  
  /* 使用默认的触摸行为，让浏览器自行处理 */
  touch-action: auto;
  -webkit-overflow-scrolling: touch;
}

/* 移动端专用的应用容器 - 参与flex布局 */
#app {
  flex: 1 0 auto;
  width: 100%;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
}

/* 移动端按钮优化 */
button {
  -webkit-appearance: none;
  appearance: none;
  border: none;
  outline: none;
  cursor: pointer;
  
  /* 按钮点击效果 */
  transition: transform 0.1s ease, background-color 0.2s ease;
  
  /* 确保文字居中 */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
}

button:active {
  transform: scale(0.98);
}

/* 移动端输入框优化 */
input {
  -webkit-appearance: none;
  appearance: none;
  border: none;
  outline: none;
  
  /* iOS输入框优化 */
  -webkit-border-radius: 0;
  border-radius: 8px;
  
  /* 防止iOS输入框的内阴影 */
  -webkit-box-shadow: none;
  box-shadow: none;
}

/* 防止iOS输入框聚焦时的放大 */
input[type="text"],
input[type="search"],
input[type="email"],
input[type="password"] {
  font-size: 16px;
}

/* 移动端Canvas优化 */
canvas {
  /* 防止选择 */
  -webkit-user-select: none;
  user-select: none;
  
  /* 防止拖拽 */
  -webkit-user-drag: none;
  user-drag: none;
  
  /* 图像渲染优化 */
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* 移动端图片优化 */
img {
  -webkit-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
  user-drag: none;
  
  /* 防止图片拖拽保存 */
  pointer-events: none;
}

/* 只在特定装饰性元素上禁用选择 */
.noselect,
.bg-pattern,
.background-image,
.image-overlay,
.mobile-puzzle-board canvas,
button {
  -webkit-user-select: none;
  user-select: none;
}

/* 移动端文本选择 */
.selectable {
  -webkit-user-select: text;
  user-select: text;
}

/* 移动端滚动优化 */
.mobile-scroll {
  -webkit-overflow-scrolling: touch;
  overflow-scrolling: touch;
}

/* 移动端动画性能优化 */
.gpu-accelerated {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
}

/* 移动端弹性滚动禁用 */
.no-bounce {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: auto;
}

/* 微信浏览器特定优化 */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  /* WebKit浏览器优化 */
  body {
    -webkit-text-size-adjust: none;
  }
}

/* 高分辨率屏幕优化 */
@media (-webkit-min-device-pixel-ratio: 2) {
  /* Retina屏幕优化 */
  .puzzle-image {
    image-rendering: -webkit-optimize-contrast;
  }
}

/* 横屏模式优化 */
@media screen and (orientation: landscape) {
  .mobile-container {
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .header-section,
  .input-section {
    width: 50%;
  }
  
  .puzzle-section {
    width: 100%;
  }
}

/* 小屏幕设备优化 */
@media screen and (max-width: 375px) {
  .character-display {
    width: 100px !important;
    height: 100px !important;
  }
  
  .puzzle-container {
    max-width: 250px !important;
  }
  
  .character-name {
    font-size: 16px !important;
  }
  
  .footer-title {
    font-size: 18px !important;
  }
}

/* 超小屏幕设备优化 */
@media screen and (max-width: 320px) {
  .header-section,
  .input-section,
  .puzzle-section {
    padding-left: 15px !important;
    padding-right: 15px !important;
  }
  
  .character-display {
    width: 80px !important;
    height: 80px !important;
  }
  
  .puzzle-container {
    max-width: 220px !important;
  }
}

/* 深色模式强制应用 */
:root {
  color-scheme: dark;
}

/* 安全区域适配（iPhone X及以上） */
@supports (padding: max(0px)) {
  .mobile-container {
    padding-left: max(20px, env(safe-area-inset-left));
    padding-right: max(20px, env(safe-area-inset-right));
    padding-bottom: max(20px, env(safe-area-inset-bottom));
  }
  
  .header-section {
    padding-top: max(20px, env(safe-area-inset-top));
  }
}

/* 消除移动端点击延迟 - 移除可能干扰滚动的touch-action设置 */

/* PWA相关样式 */
@media (display-mode: standalone) {
  /* PWA全屏模式下的样式调整 */
  body {
    padding-top: env(safe-area-inset-top);
  }
}

/* 焦点状态优化 */
button:focus,
input:focus {
  outline: 2px solid #dc3545;
  outline-offset: 2px;
}

/* 加载状态动画优化 */
@keyframes mobile-spin {
  0% { 
    transform: rotate(0deg);
  }
  100% { 
    transform: rotate(360deg);
  }
}

.loading-spinner {
  animation: mobile-spin 1s linear infinite;
  transform: translateZ(0); /* GPU加速 */
}

/* ✅ 让 Canvas 只屏蔽点击/长按，但允许纵向滚动手势 */
canvas {
  touch-action: pan-y !important;
}

/* ✅ 保险起见，把根元素也设成 pan-y */
html, body, .mobile-puzzle-app {
  touch-action: pan-y !important;
}
